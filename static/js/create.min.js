const form = document.forms[0],
  TITLE_LIMIT = 130,
  POST_LIMIT = 1e4;
form.addEventListener("submit", (t) => {
  t.preventDefault();
  const e = document.querySelector(".error"),
    i = t.target.title?.value?.trim(),
    o = t.target.post?.value?.trim();
  if (i.split(" ").join("").length > 130)
    return (
      e.classList.remove("hide"),
      void (e.innerHTML = `Your title is too long, limit is 130. You have ${
        i.split(" ").join("").length - 130
      } extra characters.`)
    );
  if (o.split(" ").join("").length > 1e4)
    return (
      e.classList.remove("hide"),
      void (e.innerHTML = `Your post is too long, limit is 10000. You have ${
        o.split(" ").join("").length - 1e4
      } extra characters.`)
    );
  if (!i.split(" ").join("").length)
    return (
      e.classList.remove("hide"),
      void (e.innerHTML =
        "Consider titling your post before clicking submit ðŸ˜’")
    );
  if (!o.split(" ").join("").length)
    return (
      e.classList.remove("hide"),
      void (e.innerHTML =
        "Consider adding content to your post (switch to writing tab on the left) before clicking submit ðŸ˜’")
    );
  (t.target.submit.disabled = !0),
    t.target.submit.classList.remove("button-primary"),
    t.target.querySelector(".loading").classList.remove("hide");
  const r = { title: i, content: o };
  fetch("/create", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(r),
  })
    .then((t) => {
      if (!t.ok) throw new Error(t.statusText + " " + t.status);
      window.location.replace("/");
    })
    .catch((e) => {
      (t.target.submit.disabled = !1),
        t.target.submit.classList.add("button-primary"),
        t.target.querySelector(".loading").classList.add("hide"),
        console.log(e);
    });
});
