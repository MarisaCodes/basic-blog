const form = document.forms[0],
  TITLE_LIMIT = 130,
  POST_LIMIT = 1e4;
form.addEventListener("submit", (t) => {
  t.preventDefault();
  let e = document.querySelector(".error"),
    i = t.target.title?.value?.trim(),
    r = t.target.post?.value?.trim();
  if (i.split(" ").join("").length > 130) {
    e.classList.remove("hide"),
      (e.innerHTML = `Your title is too long, limit is 130. You have ${
        i.split(" ").join("").length - 130
      } extra characters.`);
    return;
  }
  if (r.split(" ").join("").length > 1e4) {
    e.classList.remove("hide"),
      (e.innerHTML = `Your title is too long, limit is 130. You have ${
        r.split(" ").join("").length - 1e4
      } extra characters.`);
    return;
  }
  if (i.split(" ").join("").length) {
    if (!r.split(" ").join("").length) {
      e.classList.remove("hide"),
        (e.innerHTML = `Consider adding content to your post (switch to writing tab on the left) before clicking submit ðŸ˜’`);
      return;
    }
  } else {
    e.classList.remove("hide"),
      (e.innerHTML = `Consider titling your post before clicking submit ðŸ˜’`);
    return;
  }
  (t.target.submit.disabled = !0),
    t.target.submit.classList.remove("button-primary"),
    t.target.querySelector(".loading").classList.remove("hide");
  let s = { title: i, content: r },
    o = new URL(window.location.href);
  fetch(`${o.pathname}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(s),
  })
    .then((t) => {
      if (t.ok)
        t.json().then((t) => {
          let e = JSON.parse(t);
          window.location.replace(`/blog/${e.id}`);
        });
      else throw Error(t.statusText + " " + t.status);
    })
    .catch((e) => {
      (t.target.submit.disabled = !1),
        t.target.submit.classList.add("button-primary"),
        t.target.querySelector(".loading").classList.add("hide"),
        console.log(e);
    });
});
